<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLTF Viewer</title>
    <style>
        body {margin:0}
        h1 {font-family:Arial; font-size:14pt; text-align:center}
        canvas {display:block}
        #viewer {margin:10px auto; width:50%}
    </style>
</head>
<body>

    <h1>3D-Viewer</h1>
    <div class="container">
        <div id="viewer"></div>
    </div>

    <!-- Three.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- GLTFLoader -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <!-- OrbitControls -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        let scene, camera, renderer, controls;
        let currentModel = null;
        let modelCenter = new THREE.Vector3();  // Speichert das Zentrum des Modells

        function init() {
            // Szene, Kamera und Renderer initialisieren
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth * 0.5, window.innerHeight * 0.5);
            renderer.setClearColor(0xeeeeee); // Weißer Hintergrund
            document.getElementById('viewer').appendChild(renderer.domElement);

            // Kamera-Position
            camera.position.set(0, 2, 5);

            // Lichter hinzufügen
            const light = new THREE.AmbientLight(0x404040); // Weiches Umgebungslicht
            scene.add(light);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 1); // Richtungslicht
            directionalLight.position.set(5, 5, 5).normalize();
            scene.add(directionalLight);

            // OrbitControls aktivieren (zum Drehen, Zoomen, Schwenken)
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true; // Dämpfung für sanfte Bewegung
            controls.dampingFactor = 0.25;
            controls.screenSpacePanning = false; // Verhindert das Schwenken mit der rechten Maustaste
            controls.maxPolarAngle = Math.PI;
            controls.zoomSpeed = 2; // Höhere Zoomgeschwindigkeit

            // Render-Schleife
            animate();

            // Lade das Modell
            loadGLTFModel('Elektronik-Box.gltf'); // Hier den Namen deiner GLTF-Datei angeben
            // Event-Listener für Tastenkombination [Strg+M], um das Modell wieder in die Mitte zu setzen
            document.addEventListener('keydown', function (event) {
                if (event.ctrlKey && event.key === 'm') {
                    event.preventDefault();
                    resetModelPosition();  // Modell zur Mitte zurücksetzen
                }
            });
        }

        function animate() {
            requestAnimationFrame(animate);

            // Wenn ein Modell geladen ist, rotiere es um die y-Achse
            if (currentModel) {
                currentModel.rotation.y -= 0.01; // Geschwindigkeit der Rotation / "-": umgekehrte Drehrichtung
            }

            controls.update();
            renderer.render(scene, camera);
        }

        // Funktion zum Laden von GLTF-Modellen
        function loadGLTFModel(url) {
            const loader = new THREE.GLTFLoader();
            loader.load(url, function (gltf) {
                const model = gltf.scene;

                // Entferne das aktuelle Modell, falls vorhanden
                if (currentModel) {
                    scene.remove(currentModel);
                }

                // Erstelle eine Gruppe für das Modell
                const modelGroup = new THREE.Group();
                modelGroup.add(model);

                // Berechne die Bounding Box des Modells
                const box = new THREE.Box3().setFromObject(model);
                const center = box.getCenter(new THREE.Vector3());

                // Speichere das Zentrum des Modells
                modelCenter.copy(center);

                // Modellzentrum berechnen und verschieben, um das Rotationszentrum anzupassen
                model.position.sub(center);  // Modellzentrum auf (0, 0, 0) setzen
                // Skalierungsfaktor für GLTF-Modelle
                const scaleFactor = 35;  // Hier anpassen, falls nötig
                model.scale.set(scaleFactor, scaleFactor, scaleFactor);

                // Positioniere die Gruppe in der Mitte der Szene
                scene.add(modelGroup);
									  
                // Kamera-Target auf das Zentrum des Modells setzen
                controls.target.copy(modelCenter);
                camera.lookAt(modelCenter);
								 
                // Speichere die Gruppe als aktuelles Modell für die Rotation
                currentModel = modelGroup;

            }, undefined, function (error) {
                console.error('Fehler beim Laden des GLTF-Modells:', error);
            });
        }

        function resetModelPosition() {
            if (currentModel) {
                // Berechne erneut die Bounding Box und das Zentrum
                const box = new THREE.Box3().setFromObject(currentModel);
                const center = box.getCenter(new THREE.Vector3());

                // Modell in die Mitte verschieben
                currentModel.position.sub(center);

                // Rotationszentrum aktualisieren
                modelCenter.copy(center);
                controls.target.copy(modelCenter);
                camera.lookAt(modelCenter);
            }
        }

        // Fenstergröße anpassen
        window.addEventListener('resize', function () {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Viewer initialisieren
        init();
    </script>
</body>
</html>
